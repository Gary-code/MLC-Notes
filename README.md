# 机器学习编译 MLC

> 讲者: Tianqi Chen

* [课程主页](https://mlc.ai/summer22-zh/)

* [笔记](https://mlc.ai/zh/chapter_introduction/index.html)

## 01 机器学习编译概述

### 1.1 什么是机器学习编译

过去是通用处理器，通用软件：

![image-20220705225015332](https://s2.loli.net/2022/07/05/RKyZduBoScjaWVg.png)

AI时代，机器学习编译归根结底就是==**部署问题**==

![image-20220705225243270](https://s2.loli.net/2022/07/05/d2XJa8SvN5lARBb.png)



**什么是机器学习编译**

机器学习编译 (machine learning compilation, MLC) 是指，将机器学习算法从开发阶段，通过变换和优化算法，使其变成部署状态。

* **开发形式** 是指我们在开发机器学习模型时使用的形式。典型的开发形式包括用 PyTorch、TensorFlow 或 JAX 等通用框架编写的模型描述，以及与之相关的权重。

* **部署形式** 是指执行机器学习应用程序所需的形式。它通常涉及机器学习模型的每个步骤的支撑代码、管理资源（例如内存）的控制器，以及与应用程序开发环境的接口（例如用于 android 应用程序的 java API）。

  ![](https://mlc.ai/zh/_images/dev-deploy-form.png)



**机器学习编译的目标**

**集成与最小化依赖** 部署过程通常涉及集成 (Integration)，即将必要的元素组合在一起以用于部署应用程序。 例如，如果我们想启用一个安卓相机应用程序来检测猫，我们将需要图像分类模型的==必要代码==，但不需要模型无关的其他部分（例如，我们不需要包括用于 NLP 应用程序的embedding table）。代码集成、最小化依赖项的能力能够减小应用的大小，并且可以使应用程序部署到的更多的环境。（自己的代码+硬件厂商提供的代码集成）

**利用硬件加速** 每个部署环境都有自己的一套原生加速技术，并且其中许多是专门为机器学习开发的。机器学习编译的一个目标就是是利用硬件本身的特性进行加速。 我们可以通过构建调用原生加速库的部署代码或生成利用原生指令（如 Nvidia的TensorCore）的代码来做到这一点。

**通用优化** 有许多等效的方法可以运行相同的模型执行。 MLC 的通用优化形式是不同形式的优化，以**最小化内存**使用或**并行执行**提高执行效率的方式转换模型执行。

### 1.2 机器学习编译的关键要素

![](https://mlc.ai/zh/_images/mlc-elements.png)

**张量 (Tensor)** 是执行中最重要的元素。张量是表示神经网络模型执行的输入、输出和中间结果的多维数组。

**张量函数 (Tensor functions)** 神经网络的“知识”被编码在权重和接受张量和输出张量的计算序列中。我们将这些计算称为张量函数。值得注意的是，张量函数不需要对应于神经网络计算的单个步骤。部分计算或整个端到端计算也可以看作张量函数。

**example:**

> 实际上就是在做==**张量函数的变换**==
>
> * 右边一般会用一些底层的汇编代码实现！（这里用python写是方便大家看）

![](https://s2.loli.net/2022/07/05/ot2a1sJ6r3czZSP.png)

* 抽象和实现

![image-20220705231744668](https://s2.loli.net/2022/07/05/Bcj9z48OPiv7wMR.png)

我们使用**抽象 (Abstraction)**来表示我们用来表示相同张量函数的方式。不同的抽象可能会指定一些细节，而忽略其他**实现(Implementations)**细节。例如，`linear_relu` 可以使用另一个不同的 for 循环来实现。

**抽象**和**实现**可能是所有计算机系统中最重要的关键字。**抽象指定“做什么”，实现提供“如何”做**。没有具体的界限。根据我们的看法，for 循环本身可以被视为一种抽象，因为它可以使用 python 解释器实现或编译为本地汇编代码。



## 02 张量程序抽象

在本章中，我们将讨论对单个单元**计算步骤**的抽象以及在机器学习编译中对这些抽象的**可能的变换**。

### 2.1 元张量函数

最底层不可分割的张量函数

![image-20220706142240051](https://s2.loli.net/2022/07/06/fOL9AhrB1UbvxgD.png)

